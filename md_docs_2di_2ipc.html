<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.7" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iros: Inter-Process Communication</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init();
    </script>
  </head>
  <body>
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">
                    Iros
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2di_2ipc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Inter-Process Communication</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md58"></a> </p>
<h1><a class="anchor" id="autotoc_md59"></a>
Purpose</h1>
<p>The library module aims to provide a set of tools for inter-process communication. This builds on top of the asynchronous execution facilities provided by the <a class="el" href="md_docs_2di_2execution.html">execution module</a>.</p>
<h1><a class="anchor" id="autotoc_md60"></a>
Conceptual Overview</h1>
<p>The library aims to be agnostic over the underlying communication mechanism. The core concept is that of a connection, which is a bidirectional communication channel between two processes. The connection is represented by a pair of objects, one which is async writable and the other which is async readable. The library provides a set of functions which serialize and deserialize messages sent over the connection.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Sending Messages</h2>
<p>Sending a message is done by serializing the message into a buffer, and then writing the buffer to the connection. This is represented as a async sender, which will complete when the message has been sent.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Receiving Messages</h2>
<p>As the library is fully asynchronous, received messages are represented by a async-sequence, which produces a sequence of messages. Using this mechanism, a server is constructed by "mapping" this sequence to a sender, which in normal circumstances will send a message back to the client.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Sending and Receiving Messages</h2>
<p>In most cases, a client will want to send a message and then wait for a response. This is represented by chaining a sender which waits for a response to a sender which sends the message. This makes the response directly available, and so the client can also use it in the continuation of the async operation.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Connection Management</h2>
<p>The library provides a set of customization points for protocols to implement connection management. Starting a connection as a client is a matter of getting a sender which resolves to a connection. Starting a connection as a server involves mapping a sequence of incoming connection requests to a real connection object.</p>
<p>The next question is how to terminate a connection. The will be done by assoicating a stop token with the connection. When a stop is requested, the receiving sequence will stop producing messages, and complete after closing the resources associated with the connection.</p>
<p>Another concern is broadcasting messages to multiple clients. This requires maintaining a list of connections, and then sending a message to each one concurrently.</p>
<h1><a class="anchor" id="autotoc_md65"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md66"></a>
Defining a Message Type</h2>
<p>To use the automatic serialization and deserialization facilities, the message type must be defined with static <a class="el" href="md_docs_2di_2static__reflection.html">reflection</a> information included.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2di_2reflect_2prelude_8h.html">di/reflect/prelude.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a simple message type.</span></div>
<div class="line"><span class="keyword">struct </span>ClientMessage1 {</div>
<div class="line">    <span class="keywordtype">int</span> x;</div>
<div class="line">    <span class="keywordtype">int</span> y;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keyword">friend</span> <span class="keyword">auto</span> tag_invoke(di::Tag&lt;di::reflect&gt;, <a class="code hl_struct" href="structdi_1_1types_1_1InPlaceType.html">di::InPlaceType&lt;ClientMessage1&gt;</a>) {</div>
<div class="line">        <span class="keywordflow">return</span> di::make_fields(</div>
<div class="line">            di::field&lt;&quot;x&quot;, &amp;ClientMessage1::x&gt;,</div>
<div class="line">            di::field&lt;&quot;y&quot;, &amp;ClientMessage1::y&gt;</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a message type which requires a response.</span></div>
<div class="line"><span class="keyword">struct </span>ClientMessage2 {</div>
<div class="line">    <span class="keyword">struct </span>Response {</div>
<div class="line">        <span class="keywordtype">int</span> x;</div>
<div class="line">        <span class="keywordtype">int</span> y;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">constexpr</span> <span class="keyword">friend</span> <span class="keyword">auto</span> tag_invoke(di::Tag&lt;di::reflect&gt;, <a class="code hl_struct" href="structdi_1_1types_1_1InPlaceType.html">di::InPlaceType&lt;Response&gt;</a>) {</div>
<div class="line">            <span class="keywordflow">return</span> di::make_fields(</div>
<div class="line">                di::field&lt;&quot;x&quot;, &amp;Response::x&gt;,</div>
<div class="line">                di::field&lt;&quot;y&quot;, &amp;Response::y&gt;</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> x;</div>
<div class="line">    <span class="keywordtype">int</span> y;</div>
<div class="line">    <span class="keywordtype">int</span> z;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keyword">friend</span> <span class="keyword">auto</span> <a class="code hl_variable" href="namespacedi_1_1function_1_1tag__invoke__ns.html#a191e794736625ce4bdaaadb02b15e0e1">tag_invoke</a>(di::Tag&lt;di::reflect&gt;, <a class="code hl_struct" href="structdi_1_1types_1_1InPlaceType.html">di::InPlaceType&lt;ClientMessage2&gt;</a>) {</div>
<div class="line">        <span class="keywordflow">return</span> di::make_fields(</div>
<div class="line">            di::field&lt;&quot;x&quot;, &amp;ClientMessage2::x&gt;,</div>
<div class="line">            di::field&lt;&quot;y&quot;, &amp;ClientMessage2::y&gt;,</div>
<div class="line">            di::field&lt;&quot;z&quot;, &amp;ClientMessage2::z&gt;</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a message type which is only sent from the server.</span></div>
<div class="line"><span class="keyword">struct </span>ServerMessage {</div>
<div class="line">    <span class="keywordtype">int</span> z;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keyword">friend</span> <span class="keyword">auto</span> <a class="code hl_variable" href="namespacedi_1_1function_1_1tag__invoke__ns.html#a191e794736625ce4bdaaadb02b15e0e1">tag_invoke</a>(di::Tag&lt;di::reflect&gt;, <a class="code hl_struct" href="structdi_1_1types_1_1InPlaceType.html">di::InPlaceType&lt;ServerMessage&gt;</a>) {</div>
<div class="line">        <span class="keywordflow">return</span> di::make_fields(</div>
<div class="line">            di::field&lt;&quot;z&quot;, &amp;ServerMessage::z&gt;</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a message &quot;protocol&quot;, which consists of a list of messages which can be sent from the client, and a list of</span></div>
<div class="line"><span class="comment">// messages which can be sent from the server.</span></div>
<div class="line"><span class="keyword">using </span>MyProtocol = <a class="code hl_struct" href="structdi_1_1execution_1_1Protocol.html">di::Protocol&lt;di::meta::List&lt;ClientMessage1, ClientMessage2&gt;</a>, <a class="code hl_struct" href="structdi_1_1meta_1_1List.html">di::meta::List&lt;ServerMessage&gt;</a>&gt;;</div>
<div class="ttc" id="ainclude_2di_2reflect_2prelude_8h_html"><div class="ttname"><a href="include_2di_2reflect_2prelude_8h.html">prelude.h</a></div></div>
<div class="ttc" id="anamespacedi_1_1function_1_1tag__invoke__ns_html_a191e794736625ce4bdaaadb02b15e0e1"><div class="ttname"><a href="namespacedi_1_1function_1_1tag__invoke__ns.html#a191e794736625ce4bdaaadb02b15e0e1">di::function::tag_invoke_ns::tag_invoke</a></div><div class="ttdeci">constexpr tag_invoke_detail::TagInvokeFn tag_invoke</div><div class="ttdef"><b>Definition</b> tag_invoke.h:22</div></div>
<div class="ttc" id="astructdi_1_1execution_1_1Protocol_html"><div class="ttname"><a href="structdi_1_1execution_1_1Protocol.html">di::execution::Protocol</a></div><div class="ttdef"><b>Definition</b> ipc_protocol.h:11</div></div>
<div class="ttc" id="astructdi_1_1meta_1_1List_html"><div class="ttname"><a href="structdi_1_1meta_1_1List.html">di::meta::List</a></div><div class="ttdef"><b>Definition</b> core.h:5</div></div>
<div class="ttc" id="astructdi_1_1types_1_1InPlaceType_html"><div class="ttname"><a href="structdi_1_1types_1_1InPlaceType.html">di::types::InPlaceType</a></div><div class="ttdef"><b>Definition</b> in_place_type.h:5</div></div>
</div><!-- fragment --><p>From this example, we can see that the message types are defined as simple structs. The static reflection information allows the library to automatically serialize and deserialize the messages.</p>
<p>There can also be a nested <code>Response</code> type, which is used to represent the response to a message. This is useful for messages which require a response. The library uses this information to automatically chain waiting for the response when sending a message (this doesn't block since everything is asynchronous).</p>
<p>Additionally, a protocol is defined by 2 lists of messages. This implies that every connection is either a client or a server. In a symmetric protocol, both lists will be the same.</p>
<h1><a class="anchor" id="autotoc_md67"></a>
Synchronization</h1>
<p>Because the model involves has a separate read and write stream, there is no need for synchronization between the two. The read component is a sequence, and since it reading from a single stream, it will not produce messages out of order. However, the write component is a sender, which means that it can be invoked concurrently. This means that the messages sent over the connection may be interleaved. Because there is only a single underlying stream, the library has to synchronize the writes to ensure that data chunks from separate messages are not interleaved. Additionally, if a message expects a response, the library must synchronize with the read stream so it knows where to route decoded messages to. Note that response messages are not sent to the read stream, but are instead routed directly to the sender which is waiting for the response. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Iros Project Documentation</a></li><li class="navelem"><a class="el" href="md_docs_2di_2table__of__contents.html">Di Library Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
